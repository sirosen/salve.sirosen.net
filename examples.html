---
layout: default
---

<h1>
<a name="example-manifests" class="anchor" href="#example-manifests"><span class="octicon octicon-link"></span></a>Example Manifests</h1>

<p>To understand how a SALVE execution runs, here we present several examples and describe how an execution with them runs.</p>

<h2>
<a name="example-zsh" class="anchor" href="#example-zsh"><span class="octicon octicon-link"></span></a>Example 1: zsh Manifest</h2>

<p>Consider the following manifest that handles zsh configuration.</p>

<pre><code>file {
    source  files/zsh/zshrc
    target  $HOME/.zshrc
}

file {
    source  files/zsh/zshrc.zni
    target  $HOME/.zshrc.zni
}

file {
    source  files/zsh/zsh_git
    target  $HOME/.zsh_git
}

file {
    source  files/zsh/zsh_dircolors
    target  $HOME/.zsh_dircolors
}

file {
    source  files/zsh/myfuncs.sh
    target  $HOME/.myfuncs.sh
}</code></pre>

<p>kept in a SALVE repo, under the name of <code>zsh.manifest</code>, with the following directory structure</p>

<pre><code>zsh.manifest
LICENSE
README.md
default_settings.ini
salve.py
src
|-- ...
tests
|-- ...
files
|-- ...
`-- zsh
    |-- myfuncs.sh
    |-- zsh_dircolors
    |-- zsh_git
    |-- zshrc
    `-- zshrc.zni</code></pre>

<p>and the following <code>default_settings.ini</code>, without overrides</p>

<pre><code>[common]
backup_dir=$HOME/.salve/backups
backup_log=$HOME/.salve/backup.log

[file]
action=copy
mode=600
user=$USER
group=$SALVE_USER_PRIMARY_GROUP

[directory]
action=copy
mode=755
user=$USER
group=$SALVE_USER_PRIMARY_GROUP

[manifest]</code></pre>

<h3>
<a name="zsh-block-one" class="anchor" href="#zsh-block-one"><span class="octicon octicon-link"></span></a>zsh Manifest: Block 1</h3>

<p>When run via <code>./salve -m zsh.manifest</code>, this manifest first specifies</p>

<pre><code>file {
    source  files/zsh/zshrc
    target  $HOME/.zshrc
}</code></pre>

<p>which expands with the defaults to</p>

<pre><code>file {
    source      files/zsh/zshrc
    target      $HOME/.zshrc
    action      copy
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/.salve/backups
    backup_log  $HOME/.salve/backup.log
}</code></pre>

<p>This specifies that the file in the salve repo, at <code>$SALVE_ROOT/files/zsh/zshrc</code>, should be copied to <code>$HOME/.zshrc</code>.
Its mode should be set to <code>600</code>, and if running as root, the user and group should be set to the invoking user and that user's primary group (inspecting <code>$SUDO_USER</code> to deduce who that user is).
If there was an existing file at <code>$HOME/.zshrc</code>, it should be backed up into <code>$HOME/.salve/backups/$HOME/.zshrc/</code>, with a unique filename generated by a hash of its contents.
In the event of a backup, the date, the filename, and the hash are all logged to the backup logfile.</p>
