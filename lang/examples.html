---
layout: langpage
---

<h1><a name="examples" class="anchor" href="#examples"><span class="octicon octicon-link"></span></a>Examples</h1>

<p>To understand how a SALVE execution runs, here we present several examples and describe how an execution with them runs.</p>

<p>All examples are evaluated with the following <code>default_settings.ini</code>:</p>
<pre><code>[global]
backup_dir=$HOME/.salve/backups
backup_log=$HOME/.salve/backup.log

[common]
user=$USER
group=$SALVE_USER_PRIMARY_GROUP

[file]
action=copy
mode=600

[directory]
action=copy
mode=755

[manifest]</code></pre>

<p>and the following directory structure:</p>

<pre><code>LICENSE
README.md
default_settings.ini
salve.py
root.manifest
src
`-- ...
tests
`-- ...
manifests
|-- bash.manifest
|-- vim.manifest
`-- zsh.manifest
files
|-- bash
|   `-- bashrc
|-- zsh
|   |-- myfuncs.sh
|   |-- zsh_dircolors
|   |-- zsh_git
|   |-- zshrc
|   `-- zshrc.zni
`-- vim
    |-- solarized.vim
    `-- vimrc</code></pre>

<h1><a name="zsh" class="anchor" href="#zsh"><span class="octicon octicon-link"></span></a>Example 1: bash Manifest</h1>

<p>Consider the following manifest that handles a single bashrc file.
This is (aside from the empty manifest) about as simple as a manifest can be.</p>

<pre><code>file {
    source  files/bash/bashrc
    target  $HOME/.bashrc
}</code></pre>

<p>kept in a SALVE repo, under the name of <code>manifests/bash.manifest</code>.</p>

<h2><a name="bash-expanded" class="anchor" href="#bash-expanded"><span class="octicon octicon-link"></span></a>bash Manifest Expanded</h2>

<p>When run via <code>./salve.py deploy -m manifests/bash.manifest</code>, this manifest expandds with the defaults to</p>

<pre><code>file {
    source      files/bash/bashrc
    target      $HOME/.bashrc
    action      copy
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/.salve/backups
    backup_log  $HOME/.salve/backup.log
}</code></pre>

<p>This specifies that the file in the salve repo, at <code>$SALVE_ROOT/files/bash/bashrc</code>, should be copied to <code>$HOME/.bashrc</code>.
Its mode should be set to <code>600</code>, and if running as root, the user and group should be set to the invoking user and that user's primary group (inspecting <code>$SUDO_USER</code> to deduce who that user is).
If there was an existing file at <code>$HOME/.bashrc</code>, it should be backed up into <code>$HOME/.salve/backups/$HOME/.bashrc/</code>, with a unique filename generated by a hash of its contents.
In the event of a backup, the date, the filename, and the hash are all logged to the backup logfile at <code>$HOME/.salve/backup.log</code>.</p>


<h1><a name="zsh" class="anchor" href="#zsh"><span class="octicon octicon-link"></span></a>Example 2: zsh Manifest</h1>

<p>Consider the following manifest that handles zsh configuration, stored in <code>manifests/zsh.manifest</code>.</p>

<pre><code>file {
    source  files/zsh/zshrc
    target  $HOME/.zshrc
}

file {
    source  files/zsh/zshrc.zni
    target  $HOME/.zshrc.zni
}

file {
    source  files/zsh/zsh_git
    target  $HOME/.zsh_git
}

file {
    source  files/zsh/zsh_dircolors
    target  $HOME/.zsh_dircolors
}

file {
    source  files/zsh/myfuncs.sh
    target  $HOME/.myfuncs.sh
}</code></pre>

<h2><a name="zsh-first-block" class="anchor" href="#zsh-first-block"><span class="octicon octicon-link"></span></a>zsh Manifest: First Block</h2>

<p>When run via <code>./salve.py deploy -m manifests/zsh.manifest</code>, this manifest first specifies</p>

<pre><code>file {
    source  files/zsh/zshrc
    target  $HOME/.zshrc
}</code></pre>

<p>which expands with the defaults to</p>

<pre><code>file {
    source      files/zsh/zshrc
    target      $HOME/.zshrc
    action      copy
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/.salve/backups
    backup_log  $HOME/.salve/backup.log
}</code></pre>

<p>As with the bash manifest, this specifies that the file at <code>$SALVE_ROOT/files/zsh/zshrc</code>, should be copied to <code>$HOME/.zshrc</code>.
If there was an existing file at <code>$HOME/.zshrc</code>, it should be backed up and the backup event should be logged.</p>

<h2><a name="zsh-all-blocks" class="anchor" href="#zsh-all-blocks"><span class="octicon octicon-link"></span></a>zsh Manifest: All Blocks</h2>

<p>As a more complete view, a fully expanded manifest is</p>

<pre><code>file {
    source      files/zsh/zshrc
    target      $HOME/.zshrc
    action      copy
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/.salve/backups
    backup_log  $HOME/.salve/backup.log
}

file {
    source      files/zsh/zshrc.zni
    target      $HOME/.zshrc.zni
    action      copy
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/.salve/backups
    backup_log  $HOME/.salve/backup.log
}

file {
    source      files/zsh/zsh_git
    target      $HOME/.zsh_git
    action      copy
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/.salve/backups
    backup_log  $HOME/.salve/backup.log
}

file {
    source      files/zsh/zsh_dircolors
    target      $HOME/.zsh_dircolors
    action      copy
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/.salve/backups
    backup_log  $HOME/.salve/backup.log
}

file {
    source      files/zsh/myfuncs.sh
    target      $HOME/.myfuncs.sh
    action      copy
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/.salve/backups
    backup_log  $HOME/.salve/backup.log
}</code></pre>


<h1><a name="vim" class="anchor" href="#vim"><span class="octicon octicon-link"></span></a>Example 3: vim Manifest</h1>

<p>The following manifest handles vim configuration, and includes a directory action.
It is kept under the name of <code>manifest/vim.manifest</code>.</p>

<pre><code>directory {
    target  $home/.vim/colors
    action  create
}

file {
    source  files/vim/vimrc
    target  $HOME/.vimrc
}

file {
    source  files/vim/solarized.vim
    target  $HOME/.vim/colors/solarized.vim
}</code></pre>

<h2><a name="vim-first-block" class="anchor" href="#vim-first-block"><span class="octicon octicon-link"></span></a>vim Manifest: First Block</h2>

<p>When run via <code>./salve.py deploy -m manifest/vim.manifest</code>, this manifest first specifies</p>

<pre><code>directory {
    target  $HOME/.vim/colors
    action  create
}</code></pre>

<p>which expands with the defaults to</p>

<pre><code>directory {
    target      $HOME/.vim/colors
    action      create
    mode        755
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/salve/backups
    backup_log  $HOME/salve/backup.log
}</code></pre>

<p>This specifies that a directory at <code>$HOME/.vim/colors</code>, should be created if it does not already exist, as it would be by the shell command <code>mkdir -p</code>.
Its mode should be set to <code>755</code>, and if running as root, the user and group should be set.
<code>755</code> is recommended for directories when possible, as it is the least likely value to create error conditions later in the SALVE run.
With this action, there is no backup because the operations performed are necessarily nondestructive.</p>

<h2>
<a name="vim-all-blocks" class="anchor" href="#vim-all-blocks"><span class="octicon octicon-link"></span></a>vim Manifest: All Blocks</h2>

<p>As a more complete view, a fully expanded manifest is</p>

<pre><code>directory {
    target      $home/.vim/colors
    action      create
    mode        755
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/salve/backups
    backup_log  $HOME/salve/backup.log
}

file {
    source      files/vim/vimrc
    target      $HOME/.vimrc
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/salve/backups
    backup_log  $HOME/salve/backup.log
}

file {
    source      files/vim/solarized.vim
    target      $HOME/.vim/colors/solarized.vim
    mode        600
    user        $USER
    group       $SALVE_USER_PRIMARY_GROUP
    backup_dir  $HOME/salve/backups
    backup_log  $HOME/salve/backup.log
}</code></pre>

<p>Note that the <code>file[mode]</code> and <code>directory[mode]</code> are distinct, and that the specified directory action overrides the default <code>copy</code>.</p>
